/*! Plugins Corner - 2023-02-27
* http://www.PluginsCorner.com/
* Copyright (c) 2023 PluginsCorner */
var PLCOUtils=PLCOUtils||{},PLCO_Membership=((PLCO_Membership=PLCO_Membership||{}).models=PLCO_Membership.models||{},PLCO_Membership.collections=PLCO_Membership.collections||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.models=PLCOUtils.models||{},PLCOUtils.collections=PLCOUtils.collections||{},jQuery,PLCO_Membership.models.MembershipLevel=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{ID:null,membership_name:"",role:"subscriber",autorenew:1,status:1,recurrences:[],created_at:""},initialize:function(e){this.setRecurrences(),wp.hooks.doAction("after_initialize_membership_level",this,PLCO_Membership,PLCOUtils)},setRecurrences:function(){this.set({recurrences:new PLCO_Membership.collections.Recurrences(this.get("recurrences"))})},url:function(){let e=PLCO_Membership.routes.membership_level;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Membership.models.Pagination=PLCOUtils.models.Base.extend({defaults:{current_page:1,items_per_page:10,total_items:0,state:"ACTIVE",membership_level:null,complementary:"all",search:null,extra:[]}}),PLCO_Membership.models.SuspendedMember=PLCOUtils.models.Base.extend({}),PLCO_Membership.models.CanceledMember=PLCOUtils.models.Base.extend({}),PLCO_Membership.models.AddComplementaryMembership=PLCOUtils.models.Base.extend({defaults:{user_id:0,user_membership_id:0,current_membership_id:0,membership_id:0,recurrence:0,recurrence_type:1},url:function(){return PLCO_Membership.routes.members+"/add_complementary"}}),PLCO_Membership.models.Member=PLCOUtils.models.Base.extend({url:function(){let e=PLCO_Membership.routes.members;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Membership.models.Payment=PLCOUtils.models.Base.extend({}),PLCO_Membership.models.AvailableConnection=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{ID:null,handle:"",name:""}}),PLCO_Membership.models.Tab=PLCOUtils.models.Base.extend({defaults:{ID:"",name:"",children:[],active:!1},initialize:function(e){this.setChildren()},setChildren:function(){this.set({children:new PLCO_Membership.collections.Tabs(this.get("children"))})}}),PLCO_Membership.models.Protection=PLCOUtils.models.Base.extend({defaults:{post_id:0,membership_levels:[]},initialize:function(e){this.setMembershiplevels()},setMembershiplevels:function(){this.set({membership_levels:new PLCO_Membership.collections.MembershipLevels(this.get("membership_levels"))})},url:function(){return PLCO_Membership.routes.protection}}),PLCO_Membership.models.Connection=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{ID:null,connection_type:"",connection_name:"",api_key:"",api_secret:"",sandbox:0,extra:"",created_at:""},url:function(){let e=PLCO_Membership.routes.connection;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Membership.models.Recurrence=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{membership_id:"",recurrence:1,recurrence_type:1,cycles:0,amount:0,currency:1,created_at:""},initialize(){this.set({amount:parseFloat(this.get("amount")).toFixed(2)})},url:function(){let e=PLCO_Membership.routes.recurrence;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Membership.models.Role=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{ID:"",name:"",capabilities:{}},url:function(){let e=PLCO_Membership.routes.roles;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Membership.models.Capability=PLCOUtils.models.Base.extend({defaults:{capability:""}}),PLCO_Membership.models.Currency=PLCOUtils.models.Base.extend({defaults:{ID:"",name:"",sign:""}}),PLCO_Membership.models.RecurrenceType=PLCOUtils.models.Base.extend({defaults:{ID:"",name:""}}),PLCO_Membership.models.EmailTemplates=PLCOUtils.models.Base.extend({defaults:{success_template_subject:"",success_template_message:"",cancel_template_subject:"",cancel_template_message:""},url:function(){return PLCO_Membership.routes.email_templates}}),PLCO_Membership.models.FirstRun=PLCOUtils.models.Base.extend({defaults:{first_run_finished:!0},url:function(){return PLCO_Membership.routes.first_run}}),PLCO_Membership.models.GeneralData=PLCOUtils.models.Base.extend({defaults:{registration_page:{ID:"",name:"",url:""},success_page:{ID:"",name:"",url:""},cancel_page:{ID:"",name:"",url:""},account_page:{ID:"",name:"",url:""},allow_users_to_admin:!1,multiple_memberships:!1,hide_admin_bar:0,allow_account_delete:0,content_restriction_message:"",expired_restriction_message:""},url:function(){return PLCO_Membership.routes.general_data},validate:function(e,t){var i=[];if(i.length)return i}}),PLCO_Membership.collections.Roles=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Role}),PLCO_Membership.collections.Capabilities=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Capability}),PLCO_Membership.collections.Currencies=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Currency}),PLCO_Membership.collections.Tabs=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Tab}),PLCO_Membership.collections.RecurrencesTypes=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.RecurrenceType}),PLCO_Membership.collections.AvailableConnections=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.AvailableConnection}),PLCO_Membership.collections.Connections=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Connection}),PLCO_Membership.collections.Recurrences=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Recurrence}),PLCO_Membership.collections.MembershipLevels=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.MembershipLevel}),PLCO_Membership.collections.Protection=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Protection}),PLCO_Membership.collections.ActiveMembers=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Member,url:function(){return PLCO_Membership.routes.members}}),PLCO_Membership.collections.Payments=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Payment,url:function(){return PLCO_Membership.routes.payments}}),PLCO_Membership.collections.PendingMembers=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Member,url:function(){return PLCO_Membership.routes.members}}),PLCO_Membership.collections.NonMembers=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Member,url:function(){return PLCO_Membership.routes.members}}),PLCO_Membership.collections.SuspendedMembers=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Member,url:function(){return PLCO_Membership.routes.members}}),PLCO_Membership.collections.CanceledMembers=PLCOUtils.collections.Base.extend({model:PLCO_Membership.models.Member,url:function(){return PLCO_Membership.routes.members}}),wp.hooks.doAction("after_models_and_collections",PLCO_Membership,PLCOUtils),PLCO_Membership||{}),PLCOUtils=PLCOUtils||{},PLCO_Membership=(PLCO_Membership.views=PLCO_Membership.views||{},PLCOUtils.util=PLCOUtils.util||{},!function(l){l(function(){PLCO_Membership.views.InitProtection=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("protection_icons"),events:{"click .plco-protect-modal":"protectModal"},post_id:null,initialize:function(){let e=this;this.post_id=parseInt(this.$el.attr("data-id")),this.model=PLCO_Membership.globals.protection.findWhere({post_id:this.post_id}),this.model||(this.model=new PLCO_Membership.models.Protection({post_id:this.post_id})),this.model.on("protection_changed",function(){e.render()})},render:function(){var e=PLCO_Membership.post;return this.$el.html(this.template({id:this.post_id,model:this.model,is_in_metabox:e})),PLCOUtils.util.materialize(this.$el),this},protectModal:function(e){this.modal(PLCO_Membership.views.Protect,{"max-width":"60%",width:"1000px",fixed_footer:!0,post_id:this.post_id,model:this.model,protection_collection:PLCO_Membership.globals.protection,collection:PLCO_Membership.globals.membership_levels})}}),PLCO_Membership.views.MembershipLevelCheckbox=PLCOUtils.views.Base.extend({className:"col s3",template:PLCOUtils.util.template("membership_checkbox"),events:{"click .plco-protect-check":"protectCheck"},initialize:function(e){this.protection_model=e.protection_model},render:function(){var e=this.protection_model.get("membership_levels").findWhere({ID:parseInt(this.model.get("ID"))});return this.$el.html(this.template({model:this.model,checked:e})),this},protectCheck:function(){var e=this.protection_model.get("membership_levels").findWhere({ID:parseInt(this.model.get("ID"))});e?this.protection_model.get("membership_levels").remove(e):this.protection_model.get("membership_levels").add(this.model)}}),PLCO_Membership.views.FirstRun=PLCOUtils.views.Base.extend({render:function(){return this.modal(PLCO_Membership.views.FirstRunModal,{"max-width":"60%",width:"1000px",fixed_footer:!0,no_close:!0,dismissible:!1,model:this.model,general_data:PLCO_Membership.globals.general_data}),this}}),PLCO_Membership.views.Tabs=PLCOUtils.views.Base.extend({className:"row plco-tabs",template:PLCOUtils.util.template("tabs"),render:function(){return this.$el.html(this.template()),this.renderTabs(),this},renderTabs:function(){this.collection.each(this.renderTab,this)},renderTab:function(e){var t;this.model.get("ID")===e.get("ID")?e.set({active:!0}):e.set({active:!1}),!1!==e.get("show")&&(t=new PLCO_Membership.views.Tab({model:e,collection:this.collection}),this.$el.find(".plco-tab-items").append(t.render().$el)),e.get("active")&&this.renderTabContent()},renderTabContent:function(){let e=PLCOUtils.util.inflect.to_title_case(this.model.get("ID").replace("_"," ")).replace(" ","")+"TabContent";PLCOUtils.util.contains(Backbone.history.getFragment(),"/")&&(e="add"===Backbone.history.getFragment().split("/")[1]?this.model.get("name").replace(" ","")+"AddTabContent":this.model.get("name").replace(" ","")+"EditTabContent");var t=Backbone.history.getFragment().split("/"),t=(!this.collection.findWhere({ID:t[0]})&&0<this.model.get("children").length&&(t=this.model.get("children").findWhere({ID:t[0]}))&&(e=PLCOUtils.util.inflect.to_title_case(t.get("ID").replace("_"," ")).replace(" ","")+"TabContent"),new PLCO_Membership.views[e]({children_tabs:this.model.get("children")}));this.$el.find(".plco-tab-content").html(t.render().$el)}}),PLCO_Membership.views.Tab=PLCOUtils.views.Base.extend({tagName:"li",className:"plco-tab-item",template:PLCOUtils.util.template("tab"),initialize:function(e){this.model.get("active")&&this.$el.addClass("plco-active-tab")},render:function(){return this.$el.html(this.template({model:this.model})),this}}),PLCO_Membership.views.MembershipLevelsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("membership_levels_content"),initialize:function(){let e=this;PLCO_Membership.globals.membership_levels.on("membership_level_delete",function(){e.render()})},render:function(){return this.$el.html(this.template()),this.renderMembershipLevels(),PLCO_Membership.globals.page_loader.close(),this},renderMembershipLevels:function(){PLCO_Membership.globals.membership_levels.each(this.renderMembershipLevel,this)},renderMembershipLevel:function(e){e=new PLCO_Membership.views.MembershipLevelCard({model:e,collection:PLCO_Membership.globals.membership_levels});this.$el.find(".plco-membership-levels-content").append(e.render().$el)}}),PLCO_Membership.views.MembershipLevelsAddTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("membership_levels_add_content"),render:function(){return this.setData(),this.$el.html(this.template({model:this.model})),this.renderForm(),wp.hooks.doAction("plcom_after_render_membership_tab_content",this),PLCO_Membership.globals.page_loader.close(),this},setData(){this.model=new PLCO_Membership.models.MembershipLevel},renderForm:function(){var e=new PLCO_Membership.views.MembershipLevelForm({model:this.model,collection:PLCO_Membership.globals.membership_levels});this.$el.find(".plco-add-membership-level-content").append(e.render().$el)}}),PLCO_Membership.views.MembershipLevelsEditTabContent=PLCO_Membership.views.MembershipLevelsAddTabContent.extend({setData(){var e=parseInt(Backbone.history.getFragment().split("/")[1]);this.model=PLCO_Membership.globals.membership_levels.findWhere({ID:e})}}),PLCO_Membership.views.ShortcodesTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("shortcodes_content"),render:function(){return this.$el.html(this.template({model:this.model})),PLCOUtils.util.materialize(this.$el),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.ActiveMembersTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("active_members_content"),events:{"click .plco-go-first":"goToFirst","click .plco-go-to-page":"goToPage","change .plcom-membership-levels":"changeLevel","change .plcom-complementary":"changeComp","change #plco-search":"search","click .plco-go-last":"goToLast"},initialize:function(e){this.children_tabs=e.children_tabs,this.options=e,this.setData(),this.fetchData();let t=this;this.model.on("reset_collection",function(){t.render()})},setData:function(){this.model=new PLCO_Membership.models.Pagination,this.collection=new PLCO_Membership.collections.ActiveMembers},changeLevel:function(e){e=e.target.value;this.model.set({membership_level:e}),this.fetchData()},changeComp:function(e){e=e.target.value;this.model.set({complementary:e}),this.fetchData()},search:function(e){e=e.target.value;this.model.set({search:e}),this.fetchData()},fetchData:function(){let s=this;PLCO_Membership.globals.page_loader.open();var e=this.collection.fetch({data:this.model.toJSON()});e&&(e.success(function(e,t,i){s.collection=new PLCO_Membership.collections.ActiveMembers(e.members),s.model.set({total_items:parseInt(e.total_items)}),PLCO_Membership.globals.members=s.collection,s.model.trigger("reset_collection"),s.collection.on("added_comp",function(){s.fetchData()}),s.collection.on("membership_suspended",function(){s.fetchData()})}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))},render:function(){return this.$el.html(this.template({model:this.model})),this.renderTabs(),this.renderRows(),this.renderPagination(),this.renderFilters(),PLCOUtils.util.materialize(this.$el),this},renderFilters:function(){PLCO_Membership.globals.membership_levels.each(this.renderLevel,this)},renderLevel:function(e){let t="";1===parseInt(e.get("ID"))?(t="all"===this.model.get("membership_level")?"selected":"",this.$el.find(".plcom-membership-levels").append('<option value="all" '+t+">All</option>")):(t=parseInt(this.model.get("membership_level"))===e.get("ID")?"selected":"",this.$el.find(".plcom-membership-levels").append('<option value="'+e.get("ID")+'" '+t+">"+e.get("membership_name")+"</option>"))},renderTabs:function(){this.children_tabs.each(this.renderTab,this)},renderTab:function(e){var t=Backbone.history.getFragment().split("/"),t=(this.children_tabs.findWhere({ID:t[0]}).get("ID")===e.get("ID")?e.set({active:!0}):e.set({active:!1}),new PLCO_Membership.views.Tab({model:e,collection:this.collection}));this.$el.find(".plco-tab-members-items").append(t.render().$el)},goToFirst:function(){this.model.set({current_page:1}),this.fetchData()},goToPage:function(e){e=l(e.currentTarget).attr("data-number");this.model.set({current_page:parseInt(e)}),this.fetchData()},goToLast:function(){var e=Math.ceil(parseInt(this.model.get("total_items"))/parseInt(this.model.get("items_per_page")));this.model.set({current_page:e}),this.fetchData()},renderRows:function(){this.collection.each(this.renderRow,this)},renderRow:function(e){e=new PLCO_Membership.views.Member({model:e,collection:this.collection});this.$el.find(".plco-members-data").append(e.render().$el)},renderPagination:function(){var e;0<parseInt(this.model.get("total_items"))&&(e=new PLCO_Membership.views.MemberPagination({model:this.model}),this.$el.find(".plco-members-pagination").append(e.render().$el))}}),PLCO_Membership.views.SuspendedMembersTabContent=PLCO_Membership.views.ActiveMembersTabContent.extend({setData:function(){this.model=new PLCO_Membership.models.Pagination({state:"SUSPENDED"}),this.collection=new PLCO_Membership.collections.SuspendedMembers}}),PLCO_Membership.views.CanceledMembersTabContent=PLCO_Membership.views.ActiveMembersTabContent.extend({setData:function(){this.model=new PLCO_Membership.models.Pagination({state:"CANCELED"}),this.collection=new PLCO_Membership.collections.CanceledMembers}}),PLCO_Membership.views.PendingMembersTabContent=PLCO_Membership.views.ActiveMembersTabContent.extend({setData:function(){this.model=new PLCO_Membership.models.Pagination({state:"PENDING"}),this.collection=new PLCO_Membership.collections.PendingMembers}}),PLCO_Membership.views.NonMembersTabContent=PLCO_Membership.views.ActiveMembersTabContent.extend({setData:function(){this.model=new PLCO_Membership.models.Pagination({state:"NON"}),this.collection=new PLCO_Membership.collections.NonMembers}}),PLCO_Membership.views.PaymentsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("payments_content"),events:{"click .plco-go-first":"goToFirst","click .plco-go-to-page":"goToPage","click .plco-go-last":"goToLast"},initialize:function(e){this.data_fetched=!1,this.children_tabs=e.children_tabs,this.setData(),this.fetchData();let t=this;this.model.on("reset_collection",function(){t.data_fetched=!0,t.render()})},render:function(){return this.data_fetched&&(this.$el.html(this.template({model:this.model})),this.renderRows(),this.renderPagination()),this},goToFirst:function(){this.model.set({current_page:1}),this.fetchData()},goToPage:function(e){e=l(e.currentTarget).attr("data-number");this.model.set({current_page:parseInt(e)}),this.fetchData()},goToLast:function(){var e=Math.ceil(parseInt(this.model.get("total_items"))/parseInt(this.model.get("items_per_page")));this.model.set({current_page:e}),this.fetchData()},setData:function(){this.model=new PLCO_Membership.models.Pagination,this.collection=new PLCO_Membership.collections.Payments},fetchData:function(){let s=this;PLCO_Membership.globals.page_loader.open();var e=this.collection.fetch({data:this.model.toJSON()});e&&(e.success(function(e,t,i){s.collection=new PLCO_Membership.collections.Payments(e.payments),s.model.set({total_items:parseInt(e.total_items)}),s.model.trigger("reset_collection")}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))},renderRows:function(){this.collection.each(this.renderRow,this)},renderRow:function(e){e=new PLCO_Membership.views.Payment({model:e});this.$el.find(".plco-payment-data").append(e.render().$el)},renderPagination:function(){var e;0<parseInt(this.model.get("total_items"))&&(e=new PLCO_Membership.views.MemberPagination({model:this.model}),this.$el.find(".plco-members-pagination").append(e.render().$el))}}),PLCO_Membership.views.MembershipPaymentsContent=PLCO_Membership.views.PaymentsTabContent.extend({setData:function(){var e=parseInt(Backbone.history.getFragment().split("/")[1]);this.model=new PLCO_Membership.models.Pagination({extra:[{user_membership_id:e}]}),this.collection=new PLCO_Membership.collections.Payments}}),PLCO_Membership.views.Payment=PLCOUtils.views.Base.extend({className:"plco-payment-row",tagName:"tr",template:PLCOUtils.util.template("payment_row"),render:function(){var e=PLCO_Membership.globals.currencies.findWhere({ID:parseInt(this.model.get("recurrence").currency)}),t=PLCO_Membership.globals.recurrence_types.findWhere({ID:parseInt(this.model.get("recurrence").recurrence_type)});return this.$el.html(this.template({model:this.model,currency:e,recurrence_type:t})),PLCOUtils.util.materialize(this.$el),this}}),PLCO_Membership.views.MemberPagination=PLCOUtils.views.Base.extend({className:"right",template:PLCOUtils.util.template("pagination"),render:function(){var e=Math.ceil(parseInt(this.model.get("total_items"))/parseInt(this.model.get("items_per_page"))),t=this.getPagingRange(this.model.get("current_page"),{min:1,total:e,length:5});return this.$el.html(this.template({model:this.model,number_pages:e,pages:t})),PLCOUtils.util.materialize(this.$el),this},getPagingRange:function(e,{min:t=1,total:i=20,length:s=5}={}){i<s&&(s=i);let l=e-Math.floor(s/2);return l=Math.max(l,t),l=Math.min(l,t+i-s),Array.from({length:s},(e,t)=>l+t)}}),PLCO_Membership.views.Member=PLCOUtils.views.Base.extend({className:"plco-member-row",tagName:"tr",template:PLCOUtils.util.template("member_row"),events:{"click .plco-suspend-membership":"suspendMembership","click .plco-comp-membership":"compMembership"},render:function(){return this.$el.html(this.template({model:this.model})),PLCOUtils.util.materialize(this.$el),this},suspendMembership:function(){this.modal(PLCO_Membership.views.SuspendMember,{model:this.model,collection:this.collection})},compMembership:function(){this.modal(PLCO_Membership.views.AddComplementaryMembership,{current_membership:this.model,collection:this.collection,model:new PLCO_Membership.models.AddComplementaryMembership({user_membership_id:this.model.get("ID"),user_id:this.model.get("user").ID,current_membership_id:this.model.get("membership").ID})})}}),PLCO_Membership.views.EmailTemplatesTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("email_templates_content"),events:{"click .plco-save-email-templates":"save"},render:function(){return this.$el.html(this.template()),this.renderTemplates(),PLCOUtils.util.materialize(this.$el),this},renderTemplates:function(){var e=new PLCO_Membership.views.EmailTemplates({model:PLCO_Membership.globals.email_templates});this.$el.find(".plco-email-templates-wrapper").append(e.render().$el)},save:function(){var e=PLCO_Membership.globals.email_templates.save();PLCO_Membership.globals.page_loader.open(),e&&(e.success(function(e,t,i){PLCO_Membership.globals.email_templates.set(e)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Membership.views.EmailTemplates=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("email_templates"),events:{"input .plco-input":"setInput"},render:function(){return this.$el.html(this.template({model:this.model})),this.renderEditors(),PLCO_Membership.globals.page_loader.close(),this},setInput:function(e){var t=l(e.target).attr("name"),e=e.target.value;this.model.set({[t]:e})},renderEditors:function(){let e=["success_template_message","cancel_template_message","requires_action_template_message"],i=this;setTimeout(function(){e.forEach(function(t){PLCOUtils.util.clearMCEEditor(t);var e=PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},t);e&&(tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit[t].setup=function(e){e.on("change",function(){i.model.set(t,e.getContent()),e.save()})},tinyMCE.init(tinyMCEPreInit.mceInit[t]),window.wpActiveEditor=t,tinyMCE.get(t).setContent(i.model.get(t)))})},300)}}),PLCO_Membership.views.PaymentMethodsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("payment_methods_content"),render:function(){return this.$el.html(this.template()),this.renderConnections(),PLCO_Membership.globals.page_loader.close(),this},renderConnections:function(){this.$el.find(".connection-collection-item").remove(),PLCO_Membership.globals.available_connections.each(this.renderConnection,this)},renderConnection:function(e){e=new PLCO_Membership.views.AvailableConnection({model:e,collection:PLCO_Membership.globals.connections});this.$el.find(".plco-available-connections").append(e.render().$el)}}),PLCO_Membership.views.SettingsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("settings_content"),render:function(){return this.$el.html(this.template()),this.renderSettings(),PLCO_Membership.globals.page_loader.close(),this},renderSettings:function(){var e=new PLCO_Membership.views.Settings({model:PLCO_Membership.globals.general_data});this.$el.find(".plco-settings-wrapper").append(e.render().$el)}}),PLCO_Membership.views.Settings=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("settings_data"),events:{"click .plco-click":"clickLever","input .plco-input":"changeInput","click .plco-save-settings":"save"},render:function(){return this.$el.html(this.template({model:this.model})),this.renderAutocomplete(),this.contentRestrictionMessage(),wp.hooks.doAction("plcom_after_settings_render",this),PLCOUtils.util.materialize(this.$el),this},clickLever:function(e){e=l(e.target).attr("name");this.model.set({[e]:!this.model.get(e)})},changeInput:function(e){var t=l(e.target).attr("name");this.model.set({[t]:e.target.value})},renderAutocomplete:function(){let s=this,e=this.$el.find(".plco-autocomplete");_.each(e,function(e){let i=l(e).attr("name");setTimeout(function(){PLCOUtils.util.autocomplete({inputId:l(e).attr("id"),ajaxUrl:PLCO_Membership.routes.autocomplete,onTyping:function(e){e?s.$el.find("#plco-"+i+"-create").attr("disabled","true"):s.$el.find("#plco-"+i+"-create").removeAttr("disabled"),s.model.set(i+"_page",{ID:"",name:"",url:""})},onClick:function(e,t){l(e).hasClass("page-create")?(s.model.set(i+"_page",{ID:"",name:s.$el.find("#plco-"+i+"-search").val(),url:""}),s.save()):(e=l(e).attr("id"),t=t.findWhere({ID:parseInt(e)}),s.model.set(i+"_page",{ID:t.get("ID"),name:t.get("post_title"),url:t.get("guid")}))},onEmptyData:function(e){return"<span class='plco-no-page'>No page found. </span><span class='page-create green btn white-text'>Create Page</span>"}})},0)})},contentRestrictionMessage:function(){let t=this;return setTimeout(function(){PLCOUtils.util.clearMCEEditor("content_restriction_message");var e=PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},"content_restriction_message"),e=(e&&(tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit.content_restriction_message.setup=function(e){e.on("change",function(){t.model.set("content_restriction_message",e.getContent()),e.save()})},tinyMCE.init(tinyMCEPreInit.mceInit.content_restriction_message),window.wpActiveEditor="content_restriction_message",tinyMCE.get("content_restriction_message").setContent(t.model.get("content_restriction_message"))),PLCOUtils.util.clearMCEEditor("expired_restriction_message"),PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},"expired_restriction_message"));e&&(tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,e.mce_init),tinyMCEPreInit.mceInit.expired_restriction_message.setup=function(e){e.on("change",function(){t.model.set("expired_restriction_message",e.getContent()),e.save()})},tinyMCE.init(tinyMCEPreInit.mceInit.expired_restriction_message),window.wpActiveEditor="expired_restriction_message",tinyMCE.get("expired_restriction_message").setContent(t.model.get("expired_restriction_message")))},500),this},save:function(){let e=this.model.save(),s=this;PLCO_Membership.globals.page_loader.open(),e&&(e.success(function(e,t,i){s.model.set(e)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Membership.views.IntegrationsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("integrations_content"),render:function(){var e;return PLCO_Membership.is_pro&&PLCOUtils.util.lic_control_gen()&&PLCOUtils.util.hash(PLCOUtils.globals.license.get("control"))===PLCOUtils.util.lic_control_gen()?(e=new PLCO_Membership.views.IntegrationsTabContentPro,this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.UnpaidInvoicesTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("invoices"),initialize:function(e){this.children_tabs=e.children_tabs},render:function(){var e;return PLCO_Membership.is_pro&&PLCOUtils.util.v()?(e=new PLCO_Membership.views.UnpaidInvoicesTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.PaidInvoicesTabContent=PLCO_Membership.views.UnpaidInvoicesTabContent.extend({template:PLCOUtils.util.template("invoices"),render:function(){var e;return PLCO_Membership.is_pro&&PLCOUtils.util.v()?(e=new PLCO_Membership.views.PaidInvoicesTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.TemplateSettingsTabContent=PLCO_Membership.views.UnpaidInvoicesTabContent.extend({render:function(){var e;return PLCO_Membership.is_pro?(e=new PLCO_Membership.views.TemplateSettingsTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.InvoiceSettingsTabContent=PLCO_Membership.views.UnpaidInvoicesTabContent.extend({render:function(){var e;return PLCO_Membership.is_pro?(e=new PLCO_Membership.views.InvoiceSettingsTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.StatisticsTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("statistics_content"),initialize:function(e){this.children_tabs=e.children_tabs},render:function(){var e;return PLCO_Membership.is_pro&&PLCOUtils.util.lic_control_gen()&&PLCOUtils.util.hash(PLCOUtils.globals.license.get("control"))===PLCOUtils.util.lic_control_gen()?(e=new PLCO_Membership.views.StatisticsTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.RevenueTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("statistics_content"),initialize:function(e){this.children_tabs=e.children_tabs},render:function(){var e;return PLCO_Membership.is_pro?(e=new PLCO_Membership.views.RevenueTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.RevenueGrowthTabContent=PLCO_Membership.views.RevenueTabContent.extend({render:function(){var e;return PLCO_Membership.is_pro?(e=new PLCO_Membership.views.RevenueGrowthTabContentPro({children_tabs:this.children_tabs}),this.$el.append(e.render().$el)):this.$el.html(this.template()),PLCO_Membership.globals.page_loader.close(),this}}),PLCO_Membership.views.RolesTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("roles_content"),initialize:function(){let e=this;PLCO_Membership.globals.roles.on("role_deleted",function(){e.render()})},render:function(){return this.$el.html(this.template()),this.renderRoles(),PLCO_Membership.globals.page_loader.close(),this},renderRoles:function(){PLCO_Membership.globals.roles.each(this.renderRole,this)},renderRole:function(e){e=new PLCO_Membership.views.RoleItem({model:e,collection:PLCO_Membership.globals.roles});this.$el.find(".plco-roles").append(e.render().$el)}}),PLCO_Membership.views.RolesAddTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("roles_add_content"),initialize:function(){PLCO_Membership.globals.roles.on("role_saved",function(){PLCO_Membership.router.navigate("#roles",{trigger:!0})})},render:function(){return this.$el.html(this.template()),this.renderForm(),PLCO_Membership.globals.page_loader.close(),this},renderForm:function(){var e=new PLCO_Membership.views.RoleForm({model:new PLCO_Membership.models.Role,collection:PLCO_Membership.globals.roles});this.$el.find(".plco-add-role-content").append(e.render().$el),PLCOUtils.util.materialize(this.$el)}}),PLCO_Membership.views.RolesEditTabContent=PLCO_Membership.views.RolesAddTabContent.extend({renderForm:function(){var e=PLCO_Membership.globals.roles.findWhere({ID:Backbone.history.getFragment().split("/")[1]}),e=new PLCO_Membership.views.RoleForm({model:e,collection:PLCO_Membership.globals.roles});this.$el.find(".plco-add-role-content").append(e.render().$el),PLCOUtils.util.materialize(this.$el)}}),PLCO_Membership.views.RoleForm=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("role_form"),events:{"input #plco-role-name":"editRoleName","click .plco-set-role":"save"},render:function(){return this.$el.html(this.template({model:this.model})),this.renderCapabilities(),this},renderCapabilities:function(){PLCO_Membership.globals.capabilities.each(this.renderCapability,this)},renderCapability:function(e){e=new PLCO_Membership.views.Capability({model:e,role:this.model});this.$el.find(".plco-capabilities-wrapper").append(e.render().$el)},editRoleName:function(e){var e=e.target.value,t=PLCOUtils.util.inflect.slugify(e);this.$el.find("#plco-role-id").val(t),this.model.set({ID:t,name:e})},save:function(){PLCO_Membership.globals.page_loader.open();let e=this.model.save(),l=this;e&&(e.done(function(e,t,i){var s=l.collection.findWhere({slug:l.model.get("ID")});l.model.set(e),s||l.collection.add(l.model),l.collection.trigger("role_saved")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Membership.views.Capability=PLCOUtils.views.Base.extend({className:"col s2",template:PLCOUtils.util.template("capability_checkbox"),events:{"click .plco-capability-check":"editCapability"},initialize:function(e){this.role=e.role},render:function(){var e=!!this.role.get("capabilities")[this.model.get("capability")];return this.$el.html(this.template({model:this.model,checked:e})),this},editCapability:function(){this.role.get("capabilities")[this.model.get("capability")]?delete this.role.get("capabilities")[this.model.get("capability")]:this.role.get("capabilities")[this.model.get("capability")]=!0}}),PLCO_Membership.views.RoleItem=PLCOUtils.views.Base.extend({tagName:"li",className:"collection-item role-collection-item",template:PLCOUtils.util.template("role_item"),events:{"click .plco-delete-role":"deleteState","click .plco-no":"normalState","click .plco-yes":"deleteRole"},render:function(){var e="administrator"===this.model.get("ID")||"editor"===this.model.get("ID")||"author"===this.model.get("ID")||"contributor"===this.model.get("ID")||"subscriber"===this.model.get("ID");return this.$el.html(this.template({model:this.model,is_default:e})),this},normalState:function(){this.template=PLCOUtils.util.template("role_item"),this.$el.removeClass("red lighten-2 plco-delete-state"),this.render()},deleteState:function(){this.template=PLCOUtils.util.template("role_item_delete"),this.$el.addClass("red lighten-2 plco-delete-state"),this.render()},deleteRole:function(){PLCO_Membership.globals.page_loader.open();let e=this.model.destroy(),s=this;e&&(e.done(function(e,t,i){s.collection.trigger("role_deleted")}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Membership.views.MembershipLevelCard=PLCOUtils.views.Base.extend({className:"col s6 l4 xl3",template:PLCOUtils.util.template("membership_level_card"),events:{"click .plco-delete-membership-level":"deleteState","click .plco-no":"normalState","click .plco-yes":"deleteMembership"},render:function(){var e=this.model.get("recurrences").find(function(e){return 0<e.get("members")}),t=PLCO_Membership.globals.roles.findWhere({ID:this.model.get("role")});return this.$el.html(this.template({model:this.model,role:t,has_members:e})),this.renderRecurrences(),this},normalState:function(){this.template=PLCOUtils.util.template("membership_level_card"),this.render()},deleteState:function(){this.template=PLCOUtils.util.template("membership_level_card_delete"),this.render()},deleteMembership:function(){PLCO_Membership.globals.page_loader.open();let e=this.model.destroy(),s=this;e&&(e.done(function(e,t,i){s.collection.trigger("membership_level_delete")}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))},renderRecurrences:function(){this.model.get("recurrences").each(this.renderRecurrence,this)},renderRecurrence:function(e){e=new PLCO_Membership.views.RecurrenceCard({model:e,level:this.model});this.$el.find(".plco-card-recurrences").append(e.render().$el)}}),PLCO_Membership.views.RecurrenceCard=PLCOUtils.views.Base.extend({className:"col s12",template:PLCOUtils.util.template("recurrence_card"),initialize:function(e){this.level=e.level},render:function(){var e=PLCO_Membership.globals.currencies.findWhere({ID:parseInt(this.model.get("currency"))}),t=PLCO_Membership.globals.recurrence_types.findWhere({ID:parseInt(this.model.get("recurrence_type"))});return this.$el.html(this.template({model:this.model,currency:e,recurrence_type:t})),this}}),PLCO_Membership.views.NoneRow=PLCOUtils.views.Base.extend({tagName:"li",className:"collection-item none-collection-item",template:PLCOUtils.util.template("none_row"),render:function(){return this.$el.html(this.template()),this}}),PLCO_Membership.views.MembershipLevel=PLCOUtils.views.Base.extend({tagName:"li",className:"collection-item membership-collection-item",template:PLCOUtils.util.template("membership_level"),events:{"click .plco-delete-membership-level":"deleteState","click .plco-no":"normalState","click .plco-yes":"deleteMembership"},render:function(){return this.$el.html(this.template({model:this.model})),this},deleteMembership:function(){PLCOUtils.opened_modal_view.showLoader();let e=this.model.destroy(),s=this;e&&(e.done(function(e,t,i){s.collection.trigger("membership_level_delete")}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view.hideLoader()}))},normalState:function(){this.template=PLCOUtils.util.template("membership_level"),this.$el.removeClass("red lighten-2 plco-delete-state"),this.render()},deleteState:function(){this.template=PLCOUtils.util.template("membership_level_delete"),this.$el.addClass("red lighten-2 plco-delete-state"),this.render()}}),PLCO_Membership.views.AvailableConnection=PLCOUtils.views.Base.extend({tagName:"li",className:"collection-item connection-collection-item",template:PLCOUtils.util.template("available_connection"),added:null,form_opened:!1,work_model:null,events:{"click .plco-add-connection":"addConnection","click .plco-edit-connection":"editConnection","click .plco-delete-connection":"deleteState","click .plco-no":"normalState","click .plco-yes":"deleteConnection","click .plco-close-connection-form":"closeForm","click .plco-save-connection":"save","input .plco-input":"setInput","change .plco-sandbox":"setSandbox"},render:function(){return this.added=this.collection.findWhere({connection_name:this.model.get("handle")}),this.added&&(this.work_model=this.added),this.$el.html(this.template({model:this.model,added:!!this.added,form_opened:this.form_opened})),this},setInput:function(e){var t=e.target.name,e=e.target.value;this.work_model.set({[t]:e})},setSandbox:function(){this.work_model.set({sandbox:this.work_model.get("sandbox")?0:1})},closeForm:function(){this.$el.find(".plco-connection-form").empty(),this.added?this.$el.find(".plco-close-connection-form .material-icons").html("edit").removeClass("red-text").parent().removeClass("plco-close-connection-form").addClass("plco-edit-connection"):this.$el.find(".plco-close-connection-form .material-icons").html("add_circle_outline").removeClass("red-text").addClass("green-text").parent().removeClass("plco-close-connection-form").addClass("plco-add-connection")},save:function(){if(PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.showLoader():PLCO_Membership.globals.page_loader.open(),!this.work_model.isValid())return this.PLCO_display_errors(this.model);let e=this.work_model.save(),l=this;e&&(e.done(function(e,t,i){var s=l.collection.findWhere({ID:l.work_model.get("ID")});l.work_model.set(e),s||l.collection.add(l.work_model),l.render(),PLCOUtils.toast_success("Connected Successfully")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close()}))},normalState:function(){this.template=PLCOUtils.util.template("available_connection"),this.$el.removeClass("red lighten-2 plco-delete-state"),this.render()},deleteState:function(){this.template=PLCOUtils.util.template("available_connection_delete"),this.render(),this.$el.removeClass("green lighten-4"),this.$el.addClass("red lighten-2 plco-delete-state")},deleteConnection:function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.showLoader():PLCO_Membership.globals.page_loader.open();let e=this.work_model.destroy(),s=this;e&&(e.done(function(e,t,i){s.normalState()}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close()}))},addConnection:function(){this.work_model=new PLCO_Membership.models.Connection({connection_type:"payment"});var e=this.model.get("name")+"ConnectionForm",e=new PLCO_Membership.views[e]({model:this.work_model,collection:this.collection});this.work_model.set({connection_name:this.model.get("handle")}),this.$el.find(".plco-connection-form").html(e.render().$el),this.$el.find(".material-icons").html("remove_circle_outline").addClass("red-text").removeClass("green-text").parent().addClass("plco-close-connection-form").removeClass("plco-add-connection")},editConnection:function(){var e=this.model.get("name")+"ConnectionForm",e=new PLCO_Membership.views[e]({model:this.added,collection:this.collection});this.$el.find(".plco-connection-form").html(e.render().$el),PLCOUtils.util.materialize(this.$el.find(".plco-connection-form")),this.$el.find(".plco-edit-connection .material-icons").html("remove_circle_outline").addClass("red-text").removeClass("green-text").parent().addClass("plco-close-connection-form").removeClass("plco-edit-connection")}}),PLCO_Membership.views.StripeConnectionForm=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("stripe_connection_form"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),PLCO_Membership.views.PayPalConnectionForm=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("paypal_connection_form"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),PLCO_Membership.views.MembershipLevelForm=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("membership_level_form"),recurrence_model:null,delayTimer:null,saving:!1,events:{"click .plco-add-recurrence":"renderForm","click .plco-close-recurrence":"closeFormView","click .plco-set-recurrence":"setRecurrence","change #plco-roles":"setRole","input #plco-membership-name":"setName","click .plco-autorenew":"setAutorenew","click .plco-status":"setStatus","click .plco-non-members":"setAllowNonMembers"},initialize:function(){let t=this;this.model.on("renderForm",function(e){t.recurrence_model=e,t.renderFormView()}),this.model.on("renderRecurrences",function(){t.render()}),this.model.on("saveMembership",function(){t.saveMembershipLevel()})},render:function(){return this.$el.html(this.template({model:this.model})),this.renderRoles(),this.renderRecurrences(),wp.hooks.doAction("render_membership_extra_fields",this),PLCOUtils.util.materialize(this.$el),this},setAutorenew:function(){this.model.set({autorenew:this.model.get("autorenew")?0:1}),this.saveMembershipLevel()},setStatus:function(){this.model.set({status:this.model.get("status")?0:1}),this.saveMembershipLevel()},setAllowNonMembers:function(){PLCO_Membership.globals.general_data.set({allow_non_members_registration:!PLCO_Membership.globals.general_data.get("allow_non_members_registration")});var e=PLCO_Membership.globals.general_data.save();PLCO_Membership.globals.page_loader.open(),e&&(e.success(function(e,t,i){PLCO_Membership.globals.general_data.set(e)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))},setRole:function(e){e=e.target.value;this.model.set({role:e}),this.saveMembershipLevel()},setName:function(e){e=e.target.value;const t=this;this.model.set({membership_name:e}),this.model.get("membership_name")?this.$el.find(".plco-add-recurrence").removeClass("disabled"):this.$el.find(".plco-add-recurrence").addClass("disabled"),clearTimeout(this.delayTimer),this.delayTimer=setTimeout(function(){t.saving||t.saveMembershipLevel()},700)},renderRoles:function(){PLCO_Membership.globals.roles.each(this.renderRole,this)},renderRole:function(e){e=new PLCO_Membership.views.Role({model:e,membership_level:this.model});this.$el.find(".plco-roles").append(e.render().$el)},renderRecurrences:function(){var e;return this.$el.find(".plco-recurrences .collection-item").remove(),this.model.get("recurrences").length?this.model.get("recurrences").each(this.renderRecurrence,this):(e=new PLCO_Membership.views.NoneRow({}),this.$el.find(".plco-recurrences").append(e.render().$el)),this},renderRecurrence:function(e){e=new PLCO_Membership.views.Recurrence({model:e,level:this.model});return this.$el.find(".plco-recurrences").append(e.render().$el),this},renderForm:function(){this.recurrence_model=new PLCO_Membership.models.Recurrence({membership_id:this.model.get("ID")}),this.renderFormView()},closeFormView:function(){this.$el.find(".plco-recurrence-form").empty()},renderFormView:function(){var e=new PLCO_Membership.views.RecurrenceForm({model:this.recurrence_model});this.$el.find(".plco-recurrence-form").html(e.render().$el),PLCOUtils.util.materialize(this.$el)},setRecurrence:function(){this.model.isValid(),this.saveRecurrence(),this.recurrence_model.get("ID")||this.model.get("recurrences").add(this.recurrence_model),this.render()},saveRecurrence:function(){if(!this.recurrence_model.isValid())return this.PLCO_display_errors(this.recurrence_model);PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.showLoader():PLCO_Membership.globals.page_loader.open();let e=this.recurrence_model.save(),s=this;e&&(e.done(function(e,t,i){s.recurrence_model.get("ID")||s.model.get("recurrences").add(s.recurrence_model),s.collection.trigger("membership_saved")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close()}))},saveMembershipLevel:function(){if(this.saving=!0,!this.model.isValid())return this.PLCO_display_errors(this.model);if(wp.hooks.applyFilters("before_membership_level_save",!0)){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.showLoader():PLCO_Membership.globals.page_loader.open();let e=this.model.save(),l=this;e&&(e.done(function(e,t,i){var s=l.collection.findWhere({slug:l.model.get("ID")});l.model.set(e),l.model.setRecurrences(),s||l.collection.add(l.model),wp.hooks.doAction("after_membership_level_save",l),l.collection.trigger("membership_saved")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close(),l.saving=!1}))}}}),PLCO_Membership.views.Recurrence=PLCOUtils.views.Base.extend({tagName:"li",className:"collection-item",template:PLCOUtils.util.template("recurrence"),events:{"click .plco-edit-recurrence":"renderForm","click .plco-delete-recurrence":"deleteState","click .plco-no":"normalState","click .plco-yes":"deleteRecurrence"},initialize:function(e){this.level=e.level},render:function(){var e=PLCO_Membership.globals.currencies.findWhere({ID:parseInt(this.model.get("currency"))}),t=PLCO_Membership.globals.recurrence_types.findWhere({ID:parseInt(this.model.get("recurrence_type"))});return this.$el.html(this.template({model:this.model,level:this.level,currency:e,recurrence_type:t})),this},deleteRecurrence:function(){if(this.model.get("ID")){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.showLoader():PLCO_Membership.globals.page_loader.open();let e=this.model.destroy(),s=this;e&&(e.done(function(e,t,i){s.level.trigger("renderRecurrences")}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view?PLCOUtils.opened_modal_view.hideLoader():PLCO_Membership.globals.page_loader.close()}))}else this.level.trigger("renderRecurrences")},normalState:function(){this.template=PLCOUtils.util.template("recurrence"),this.$el.removeClass("red lighten-2 plco-delete-state"),this.render()},deleteState(){this.template=PLCOUtils.util.template("recurrence_delete"),this.$el.addClass("red lighten-2 plco-delete-state"),this.render()},renderForm:function(){this.level.trigger("renderForm",this.model)}}),PLCO_Membership.views.RecurrenceForm=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("recurrence_form"),events:{"input #plco-amount":"setAmount","input #plco-recurrence":"setRecurrence","input #plco-cycles":"setCycles","change #plco-recurrence-types":"setRecurrenceType","change #plco-currencies":"setCurrency"},render:function(){return this.$el.html(this.template({model:this.model})),this.renderRecurrenceTypes(),this.renderCurrencies(),this},setCycles:function(e){e=parseInt(e.target.value);this.model.set({cycles:e})},setAmount:function(e){e=parseFloat(e.target.value).toFixed(2);this.model.set({amount:e})},setRecurrence:function(e){e=parseInt(e.target.value);this.model.set({recurrence:e})},setCurrency:function(e){e=parseInt(e.target.value);this.model.set({currency:e})},setRecurrenceType:function(e){e=parseInt(e.target.value);this.model.set({recurrence_type:e})},renderCurrencies:function(){PLCO_Membership.globals.currencies.each(this.renderCurrency,this)},renderCurrency:function(e){e=new PLCO_Membership.views.Currency({model:e,recurrence:this.model});this.$el.find(".plco-currencies").append(e.render().$el)},renderRecurrenceTypes:function(){PLCO_Membership.globals.recurrence_types.each(this.renderRecurrenceType,this)},renderRecurrenceType:function(e){e=new PLCO_Membership.views.RecurrenceType({model:e,recurrence:this.model});this.$el.find(".plco-recurrence-types").append(e.render().$el)}}),PLCO_Membership.views.Role=PLCOUtils.views.Base.extend({tagName:"option",template:PLCOUtils.util.template("recurrence_type"),initialize:function(e){this.membership_level=e.membership_level,this.$el.attr({value:this.model.get("ID")}),this.membership_level.get("role")===this.model.get("ID")&&this.$el.attr({selected:"selected"})},render:function(){return this.$el.html(this.template({model:this.model})),this}}),PLCO_Membership.views.Currency=PLCOUtils.views.Base.extend({tagName:"option",template:PLCOUtils.util.template("currency"),initialize:function(e){this.recurrence=e.recurrence,this.$el.attr({value:this.model.get("ID")}),parseInt(this.recurrence.get("currency"))===parseInt(this.model.get("ID"))&&this.$el.attr({selected:"selected"})},render:function(){return this.$el.html(this.template({model:this.model})),this}}),PLCO_Membership.views.RecurrenceType=PLCOUtils.views.Base.extend({tagName:"option",template:PLCOUtils.util.template("recurrence_type"),initialize:function(e){this.recurrence=e.recurrence,this.$el.attr({value:this.model.get("ID")}),parseInt(this.recurrence.get("recurrence_type"))===parseInt(this.model.get("ID"))&&this.$el.attr({selected:"selected"})},render:function(){return this.$el.html(this.template({model:this.model})),this}})})}(jQuery),PLCO_Membership||{}),PLCOUtils=PLCOUtils||{},PLCO_Membership=(PLCO_Membership.views=PLCO_Membership.views||{},PLCOUtils.util=PLCOUtils.util||{},jQuery(function(){PLCO_Membership.views.MemberEditTabContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("membership_view"),payments:null,initialize:function(e){this.setData()},render:function(){var e;return this.model.get("user")&&(this.$el.html(this.template({model:this.model})),wp.hooks.doAction("render_view_membership_extra_fields",this),e=new PLCO_Membership.views.MembershipPaymentsContent({}),this.$el.find(".plco-user-membership-payments").append(e.render().$el)),PLCO_Membership.globals.page_loader.close(),this},setData(){var e=parseInt(Backbone.history.getFragment().split("/")[1]);this.model=new PLCO_Membership.models.Member({ID:e});let s=this;PLCO_Membership.globals.page_loader.open();e=this.model.fetch();e&&(e.success(function(e,t,i){s.model.set(e),s.render()}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}})}),PLCO_Membership||{}),PLCOUtils=PLCOUtils||{},PLCO_Membership=(PLCO_Membership.views=PLCO_Membership.views||{},PLCOUtils.util=PLCOUtils.util||{},!function(l){l(function(){PLCO_Membership.views.Protect=PLCOUtils.util.ModalSteps.extend({template:PLCOUtils.util.template("modals/protect"),events:function(){return _.extend({},PLCOUtils.util.ModalSteps.prototype.events,{"click .plco-save":"saveProtection"})},afterInitialize:function(){let e=this;PLCO_Membership.globals.membership_levels.on("membership_saved",function(){e.render()})},afterRender:function(){return PLCOUtils.util.ModalSteps.prototype.afterRender.apply(this,arguments),this.renderLevels(),this.renderForm(),this},renderLevels:function(){this.collection.each(this.renderLevel,this)},renderLevel:function(e){e=new PLCO_Membership.views.MembershipLevelCheckbox({model:e,protection_model:this.model,collection:this.collection});this.$el.find(".plco-protect-post-wrapper").append(e.render().$el)},renderForm:function(){var e=new PLCO_Membership.views.MembershipLevelForm({model:new PLCO_Membership.models.MembershipLevel,collection:PLCO_Membership.globals.membership_levels});this.$el.find(".plco-add-membership-level-content").append(e.render().$el)},saveProtection:function(){let e=this.model.save(),s=this;s.showLoader(),e&&(e.success(function(e,t,i){s.model.set(e),s.model.trigger("protection_changed"),s.model.setMembershiplevels(),PLCOUtils.toast_success("Protection Saved Successfully"),s.close()}),e.complete(function(){s.hideLoader()}))}}),PLCO_Membership.views.FirstRunModal=PLCOUtils.util.ModalSteps.extend({template:PLCOUtils.util.template("modals/first_run"),events:function(){return _.extend({},PLCOUtils.util.ModalSteps.prototype.events,{"input .plco-create":"createPage","click .plco-allow-multiple-memberships":"allowMemberships","click .plco-allow-to-admin":"allowToAdmin","click .plco-autorenew":"allowAutorenew","click .plco-save":"saveEverything","click .plco-add-level":"renderForm","click .plco-edit-membership-level":"renderForm","click .plco-modal-skip":"saveEverything"})},afterInitialize:function(){let e=this;PLCO_Membership.globals.membership_levels.on("membership_saved",function(){e.$el.find(".plco-meembership-level-form").empty(),e.renderMemberships(),e.renderConnections()}),PLCO_Membership.globals.membership_levels.on("membership_level_delete",function(){e.$el.find(".plco-meembership-level-form").empty(),e.renderMemberships(),e.renderConnections()})},afterRender:function(){let s=this,e=this.$el.find(".plco-autocomplete");PLCOUtils.util.ModalSteps.prototype.afterRender.apply(this,arguments),this.renderMemberships(),this.renderConnections(),this.open(),_.each(e,function(e){let i=l(e).attr("name");PLCOUtils.util.autocomplete({inputId:l(e).attr("id"),ajaxUrl:PLCO_Membership.routes.autocomplete,onTyping:function(e){e?s.$el.find("#plco-"+i+"-create").attr("disabled","true"):s.$el.find("#plco-"+i+"-create").removeAttr("disabled"),s.general_data.set(i+"_page",{ID:"",name:"",url:""}),s.$el.find(".plco-modal-next-step").attr("disabled","true")},onClick:function(e,t){l(e).hasClass("page-create")?(s.general_data.set(i+"_page",{ID:"",name:s.$el.find("#plco-"+i+"-search").val(),url:""}),s.$el.find(".plco-modal-next-step").removeAttr("disabled")):(e=l(e).attr("id"),t=t.findWhere({ID:parseInt(e)}),s.$el.find(".plco-modal-next-step").removeAttr("disabled"),s.general_data.set(i+"_page",{ID:t.get("ID"),name:t.get("post_title"),url:t.get("guid")}))},onEmptyData:function(e){return"<span class='plco-no-page'>No page found. </span><span class='page-create green btn white-text'>Create Page</span>"}})}),PLCOUtils.util.clearMCEEditor("content_restriction_message");var t=PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},"content_restriction_message");t&&(tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,t.mce_init),tinyMCEPreInit.mceInit.content_restriction_message.setup=function(e){e.on("change",function(){s.general_data.set("content_restriction_message",e.getContent()),e.save()})},tinyMCE.init(tinyMCEPreInit.mceInit.content_restriction_message),window.wpActiveEditor="content_restriction_message",tinyMCE.get("content_restriction_message").setContent(s.general_data.get("content_restriction_message"))),PLCOUtils.util.materialize(this.$el)},renderForm:function(e){let t=l(e.currentTarget).attr("data-id"),i;i="add"===t?new PLCO_Membership.models.MembershipLevel:PLCO_Membership.globals.membership_levels.findWhere({ID:parseInt(t)});e=new PLCO_Membership.views.MembershipLevelForm({model:i,collection:PLCO_Membership.globals.membership_levels});this.$el.find(".plco-meembership-level-form").html(e.render().$el),PLCOUtils.util.materialize(this.$el)},renderMemberships:function(){var e;this.$el.find(".membership-collection-item").remove(),this.$el.find(".none-collection-item").remove(),PLCO_Membership.globals.membership_levels.length?(PLCO_Membership.globals.membership_levels.each(this.renderMembership,this),PLCO_Membership.globals.membership_levels.length<=1&&this.$el.find(".plco-modal-next-step").removeAttr("disabled")):(e=new PLCO_Membership.views.NoneRow({}),4===this.currentStep&&this.$el.find(".plco-modal-next-step").attr("disabled","true"),this.$el.find(".plco-membership-levels").append(e.render().$el))},renderConnections:function(){this.$el.find(".connection-collection-item").remove(),PLCO_Membership.globals.available_connections.each(this.renderConnection,this)},renderConnection:function(e){e=new PLCO_Membership.views.AvailableConnection({model:e,collection:PLCO_Membership.globals.connections});this.$el.find(".plco-available-connections").append(e.render().$el)},renderMembership:function(e){e=new PLCO_Membership.views.MembershipLevel({model:e,collection:PLCO_Membership.globals.membership_levels});this.$el.find(".plco-membership-levels").append(e.render().$el)},createPage:function(e){var t=e.currentTarget.value,e=l(e.currentTarget).attr("data-name");t?(this.$el.find(".plco-"+e+"-search").attr("disabled","true"),this.$el.find(".plco-modal-next-step").removeAttr("disabled")):(this.$el.find(".plco-"+e+"-search").removeAttr("disabled"),this.$el.find(".plco-modal-next-step").attr("disabled","true")),this.general_data.set(e+"_page",{ID:"",name:t,url:""})},allowMemberships:function(){this.general_data.set("multiple_memberships",!this.general_data.get("multiple_memberships"))},allowToAdmin:function(){this.general_data.set("allow_users_to_admin",!this.general_data.get("allow_users_to_admin"))},allowAutorenew:function(){this.general_data.set("autorenew",!this.general_data.get("autorenew"))},next:function(){1<=this.currentStep&&(this.saveGeneralData(),tinyMCE.get("content_restriction_message").setContent(this.general_data.get("content_restriction_message"))),0===this.currentStep&&PLCOUtils.util.ModalSteps.prototype.next.apply(this,arguments),0<this.currentStep&&1!==this.currentStep&&2!==this.currentStep&&this.$el.find(".plco-modal-next-step").attr("disabled","true")},saveEverything:function(){this.saveGeneralData(),this.saveGuide()},saveGeneralData:function(){let e=this.general_data.save(),s=this;s.showLoader(),e&&(e.success(function(e,t,i){s.general_data.set(e),PLCOUtils.util.ModalSteps.prototype.next.apply(s,arguments)}),e.complete(function(){s.hideLoader()}))},saveGuide:function(){this.model.set("first_run_finished",!0);let e=this.model.save(),s=this;s.showLoader(),e&&(e.success(function(e,t,i){s.model.set(e)}),e.complete(function(){s.close(),s.hideLoader()}))},prev:function(){PLCOUtils.util.ModalSteps.prototype.prev.apply(this,arguments),0===parseInt(this.currentStep)&&this.$el.find(".plco-modal-next-step").removeAttr("disabled")},goToNextStep:function(){this.model.set({tutorial_step:this.model.get("first_run_step")+1}),this.save()},save:function(){let e=this.model.save(),s=this;e&&(e.done(function(e,t,i){s.model.set(e),s.model.get("first_run_finished")?s.close():s.model.trigger("step"+s.model.get("first_run_step"))}),e.always(function(){}))}}),PLCO_Membership.views.SuspendMember=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/cancel_membership"),events:function(){return _.extend({},PLCOUtils.util.ModalSteps.prototype.events,{"click .plco-yes":"suspendMembership"})},suspendMembership:function(){this.showLoader(),this.model.set({state:"PENDING_CANCELATION"});let e=this.model.save(),s=this;e&&(e.done(function(e,t,i){s.close(),s.hideLoader(),s.collection.trigger("membership_suspended")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}))}}),PLCO_Membership.views.AddComplementaryMembership=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/add_comp"),events:function(){return _.extend({},PLCOUtils.util.ModalSteps.prototype.events,{"click .plco-save":"addMembership","change .plcom-membership-levels":"changeLevel","change #plco-recurrence-types":"setRecurrenceType","input #plco-recurrence":"setRecurrence"})},afterRender:function(){return PLCO_Membership.globals.membership_levels.each(this.renderLevel,this),this.renderRecurrenceTypes(),this},renderRecurrenceTypes:function(){PLCO_Membership.globals.recurrence_types.each(this.renderRecurrenceType,this)},renderRecurrenceType:function(e){e=new PLCO_Membership.views.RecurrenceType({model:e,recurrence:this.model});this.$el.find(".plco-recurrence-types").append(e.render().$el)},renderLevel:function(e){1===parseInt(e.get("ID"))?this.$el.find(".plcom-membership-levels").append('<option selected value="0">None</option>'):this.$el.find(".plcom-membership-levels").append('<option value="'+e.get("ID")+'">'+e.get("membership_name")+"</option>")},changeLevel:function(e){e=e.target.value;this.model.set({membership_id:parseInt(e)})},setRecurrenceType:function(e){e=parseInt(e.target.value);this.model.set({recurrence_type:e})},setRecurrence:function(e){e=parseInt(e.target.value);this.model.set({recurrence:e})},addMembership:function(){this.showLoader();let e=this.model.save(),s=this;e&&(e.done(function(e,t,i){PLCOUtils.toast_success("Membership Added Successfully"),s.close(),s.hideLoader(),s.collection.trigger("added_comp")}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message),s.hideLoader()}))}})})}(jQuery),PLCO_Membership||{}),PLCOUtils=PLCOUtils||{};PLCO_Membership.globals=PLCO_Membership.globals||{},PLCO_Membership.views=PLCO_Membership.views||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},function(s){var e=Backbone.Router.extend({$el:s("#plco-membership-content"),routes:{membership_levels:"renderTabsView",payment_methods:"renderTabsView",settings:"renderTabsView",registration_form:"renderTabsView",roles:"renderTabsView",integrations:"renderTabsView",payments:"renderTabsView",active_members:"renderTabsView",non_members:"renderTabsView",pending_members:"renderTabsView",suspended_members:"renderTabsView",canceled_members:"renderTabsView",shortcodes:"renderTabsView",unpaid_invoices:"renderTabsView",paid_invoices:"renderTabsView",invoice_settings:"renderTabsView",template_settings:"renderTabsView",statistics:"renderTabsView",revenue:"renderTabsView",revenue_growth:"renderTabsView",email_templates:"renderTabsView","membership_levels/add":"renderTabsView","roles/add":"renderTabsView","membership_levels/:id":"renderTabsView","roles/:id":"renderTabsView","member/:id":"renderTabsView"},first_run_view:null,tabs_view:null,init_view:null,first_run:function(){PLCO_Membership.globals.first_run.get("first_run_finished")||(this.first_run_view=new PLCO_Membership.views.FirstRun({model:PLCO_Membership.globals.first_run}),this.first_run_view.render())},renderTabsView:function(){this.tabs_view&&this.tabs_view.remove(),PLCO_Membership.globals.page_loader.open();let t=Backbone.history.getFragment().split("/"),i=PLCO_Membership.globals.tabs.findWhere({ID:t[0]});PLCO_Membership.globals.tabs.each(function(e){e.get("children").length&&e.get("children").findWhere({ID:t[0]})&&(i=e)}),this.tabs_view=new PLCO_Membership.views.Tabs({model:i,collection:PLCO_Membership.globals.tabs}),s(".material-tooltip").remove(),this.$el.html(this.tabs_view.render().$el)},init_protection:function(){var e=s("body").find(".plco-protection-wrapper");let i=[];e.each(function(e,t){return i.find(function(e){return e&&e.dataset&&e.dataset.id===t.dataset.id})||i.push(t),!0}),i.length&&i.forEach(function(e){var t=new PLCO_Membership.views.InitProtection({el:s(e)});s(e).append(t.render().$el)},this)}});s(function(){wp.hooks.doAction("before_globals",PLCO_Membership,PLCOUtils),PLCO_Membership.is_membership_admin_page="1"===PLCO_Membership.is_membership_admin_page,PLCO_Membership.globals.first_run=new PLCO_Membership.models.FirstRun(PLCO_Membership.first_run),PLCO_Membership.globals.email_templates=new PLCO_Membership.models.EmailTemplates(PLCO_Membership.email_templates),PLCO_Membership.globals.general_data=new PLCO_Membership.models.GeneralData(PLCO_Membership.general_data),PLCO_Membership.globals.membership_levels=new PLCO_Membership.collections.MembershipLevels(PLCO_Membership.membership_levels),PLCO_Membership.globals.available_connections=new PLCO_Membership.collections.AvailableConnections(PLCO_Membership.available_connections),PLCO_Membership.globals.connections=new PLCO_Membership.collections.Connections(PLCO_Membership.connections),PLCO_Membership.globals.recurrence_types=new PLCO_Membership.collections.RecurrencesTypes(PLCO_Membership.recurrence_types),PLCO_Membership.globals.currencies=new PLCO_Membership.collections.Currencies(PLCO_Membership.currencies),PLCO_Membership.globals.roles=new PLCO_Membership.collections.Roles(PLCO_Membership.roles),PLCO_Membership.globals.capabilities=new PLCO_Membership.collections.Capabilities(PLCO_Membership.capabilities),PLCO_Membership.globals.tabs=new PLCO_Membership.collections.Tabs(PLCO_Membership.tabs),PLCO_Membership.globals.protection=new PLCO_Membership.collections.Protection(PLCO_Membership.protected_posts),PLCO_Membership.globals.page_loader=new PLCOUtils.util.PageLoader,PLCO_Membership.globals.pro=PLCOUtils.util.lic_control_gen()&&PLCOUtils.util.hash(PLCOUtils.globals.license.get("control"))===PLCOUtils.util.lic_control_gen(),wp.hooks.doAction("after_globals",PLCO_Membership,PLCOUtils),PLCO_Membership.globals.page_loader.render(),PLCO_Membership.router=new e,PLCO_Membership.router.first_run(),Backbone.History.started||Backbone.history.start({hashchange:!0}),!Backbone.history.getFragment()&&PLCO_Membership.is_membership_admin_page&&PLCO_Membership.router.navigate("#membership_levels",{trigger:!0}),PLCO_Membership.router.init_protection(),s(".material-tooltip").remove(),s(".tooltipped").tooltip()})}(jQuery);