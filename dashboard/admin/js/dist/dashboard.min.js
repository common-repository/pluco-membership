/*! Plugins Corner - 2023-02-27
* http://www.PluginsCorner.com/
* Copyright (c) 2023 PluginsCorner */
var PLCOUtils=PLCOUtils||{},PLCO_Dashboard=((PLCO_Dashboard=PLCO_Dashboard||{}).models=PLCO_Dashboard.models||{},PLCO_Dashboard.collections=PLCO_Dashboard.collections||{},PLCO_Dashboard.util=PLCO_Dashboard.util||{},PLCO_Dashboard.models=PLCO_Dashboard.models||{},PLCO_Dashboard.collections=PLCO_Dashboard.collections||{},jQuery,PLCO_Dashboard.models.Login=PLCOUtils.models.Base.extend({defaults:{username:"",password:""},validate:function(e,s){var t=[];if(e.disconnect||(e.username||t.push(this.validation_error("username",PLCOUtils.t.NoUsername)),e.password)||t.push(this.validation_error("password",PLCOUtils.t.NoPassword)),t.length)return t},url:function(){return PLCOUtils.routes.login}}),PLCO_Dashboard.models.LicenseKey=PLCOUtils.models.Base.extend({defaults:{license_key:""}}),PLCO_Dashboard.collections.Licenses=PLCOUtils.collections.Base.extend({model:PLCO_Dashboard.models.LicenseKey,url:function(){return PLCOUtils.routes.license+"/fetch"}}),PLCO_Dashboard||{}),PLCOUtils=PLCOUtils||{},PLCO_Dashboard=(PLCO_Dashboard.views=PLCO_Dashboard.views||{},PLCOUtils.util=PLCOUtils.util||{},jQuery(function(){PLCO_Dashboard.views.Dashboard=PLCOUtils.views.Base.extend({className:"container",template:PLCOUtils.util.template("dashboard"),initialize:function(){const e=this;this.model.on("success_lic_added",function(){e.render()})},render:function(){return PLCOUtils.util.lic_control_gen()&&PLCOUtils.util.hash(this.model.get("control"))===PLCOUtils.util.lic_control_gen()&&(PLCOUtils.globals.control_check=PLCOUtils.util.hash(this.model.get("control")),this.model.set({valid:!0})),this.$el.empty(),this.$el.html(this.template({})),this.renderLicense(),this.renderProducts(),this},renderLicense:function(){let e;(e=new(this.model.get("license_key")&&this.model.get("valid")?PLCO_Dashboard.views.LicenseGreeting:PLCO_Dashboard.views.LicenseForm)({el:this.$(".plco-license-wrapper"),model:this.model})).render()},renderProducts:function(){this.collection.each(this.renderProduct,this)},renderProduct:function(e){var s=this.model.get("products"),s=(this.model.get("license_key")&&PLCOUtils.globals.control_check&&PLCOUtils.util.contains(s,e.get("ID"))&&e.set({has_access:!0}),new PLCO_Dashboard.views.Product({model:e}));("development"===e.get("state")?this.$("#plco-development-container"):this.$("#plco-products-container")).append(s.render().$el)}}),PLCO_Dashboard.views.LicenseGreeting=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("license_added"),events:{"click .plco-delete-license":"deleteLicense"},render:function(){return this.$el.html(this.template({model:this.model})),this},deleteLicense:function(){this.modal(PLCO_Dashboard.views.RemoveLicense,{"max-width":"30%",width:"600px",model:this.model})}}),PLCO_Dashboard.views.LicenseForm=PLCOUtils.views.Base.extend({className:"row",template:PLCOUtils.util.template("license_form"),events:{"input #plco-username":"setUsername","input #plco-password":"setPassword","click .plco-login":"login","click .plco-fetch-licenses":"fetchLicenses","click .plco-disconnect":"disconnect"},initialize:function(e){this.login_model=new PLCO_Dashboard.models.Login,this.licenses=new PLCO_Dashboard.collections.Licenses},render:function(){return this.$el.html(this.template({model:this.model})),this.renderLicenseKeys(),PLCOUtils.util.materialize(this.$el),this},renderLicenseKeys:function(){0<this.licenses.length&&(this.$el.find(".plco-license-keys-wrapper").empty(),this.licenses.each(this.renderLicenseKey,this),this.$el.find(".plco-fetch-licenses").attr("disabled",!0))},renderLicenseKey:function(e){e=new PLCO_Dashboard.views.LicenseKeyItem({model:this.model,license_key:e});this.$el.find(".plco-license-keys-wrapper").append(e.render().$el)},setUsername:function(e){this.login_model.set({username:e.target.value})},setPassword:function(e){this.login_model.set({password:e.target.value})},disconnect:function(){this.modal(PLCO_Dashboard.views.Disconnect,{"max-width":"30%",width:"600px",model:this.model,login_model:this.login_model})},login:function(){if(!this.login_model.isValid())return this.PLCO_display_errors(this.login_model);PLCO_Membership.globals.page_loader.open();let e=this.login_model.save(),i=this;e&&(e.done(function(e,s,t){i.model.set("jwt_access",e.access),i.model.set("jwt_refresh",e.refresh),i.render()}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))},fetchLicenses:function(){PLCO_Membership.globals.page_loader.open();let e=this.licenses.fetch(),i=this;e&&(e.done(function(e,s,t){i.render()}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Dashboard.views.LicenseKeyItem=PLCOUtils.views.Base.extend({className:"plco-license-key-item",template:PLCOUtils.util.template("license_key_item"),events:{"click .plco-use-license":"addLicense"},initialize:function(e){this.license_key=e.license_key},render:function(){return this.$el.html(this.template({license:this.license_key})),this},addLicense:function(){this.model.set("license_key",this.license_key.get("license_key")),PLCO_Membership.globals.page_loader.open();var e=this.model.fetch({data:this.model.toJSON()}),i=this;e&&(e.success(function(e,s,t){i.model.set(e),PLCOUtils.license=e}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message),i.model.set({valid:!1})}),e.complete(function(e){i.model.trigger("success_lic_added"),PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Dashboard.views.Product=PLCOUtils.views.Base.extend({className:"col s3",template:PLCOUtils.util.template("product"),render:function(){return this.$el.html(this.template({model:this.model})),this}})}),PLCO_Dashboard||{}),PLCOUtils=PLCOUtils||{},PLCO_Dashboard=(PLCO_Dashboard.views=PLCO_Dashboard.views||{},PLCOUtils.util=PLCOUtils.util||{},jQuery(function(){PLCO_Dashboard.views.RemoveLicense=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/delete_license"),events:{"click .plco-yes":"removeLicense"},removeLicense:function(){PLCO_Membership.globals.page_loader.open();let e=this.model.destroy(),i=this;e&&(e.done(function(e,s,t){i.model.set(e),i.model.trigger("success_lic_added"),i.close()}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}}),PLCO_Dashboard.views.Disconnect=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/disconnect"),events:{"click .plco-yes":"disconnect"},disconnect:function(){PLCO_Membership.globals.page_loader.open();let e=this.login_model.save({disconnect:!0}),i=this;e&&(e.done(function(e,s,t){i.model.set("jwt_access",""),i.model.set("jwt_refresh",""),PLCOUtils.license.jwt_access="",PLCOUtils.license.jwt_refresh="",i.model.trigger("success_lic_added"),i.close()}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCO_Membership.globals.page_loader.close()}))}})}),PLCO_Dashboard||{}),PLCOUtils=PLCOUtils||{};PLCO_Dashboard.globals=PLCO_Dashboard.globals||{},PLCO_Dashboard.views=PLCO_Dashboard.views||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},function(e){var s=Backbone.Router.extend({$el:e("#plco-dashboard-content"),routes:{dashboard:"dashboard"},dash_view:null,dashboard:function(){this.dash_view&&this.dash_view.remove();var i=this,e=PLCOUtils.globals.license.get("control");PLCOUtils.globals.license.get("license_key")&&!e?PLCOUtils.globals.license.fetch({data:PLCOUtils.license}).success(function(e,s,t){PLCOUtils.globals.license.set(e),PLCOUtils.license=e,i.renderDashboard()}):this.renderDashboard(),PLCOUtils.globals.license.on("success_lic_added",function(){i.renderDashboard()})},renderDashboard:function(){this.dash_view=new PLCO_Dashboard.views.Dashboard({model:PLCOUtils.globals.license,collection:PLCOUtils.globals.products}),this.$el.html(this.dash_view.render().$el),window.scrollTo(0,0)}});e(function(){PLCO_Dashboard.router=new s,Backbone.History.started||Backbone.history.start({hashchange:!0}),Backbone.history.getFragment()?(Backbone.history.fragment=null,Backbone.history.navigate(Backbone.history.getFragment(),{trigger:!0})):PLCO_Dashboard.router.navigate("#dashboard",{trigger:!0})})}(jQuery);