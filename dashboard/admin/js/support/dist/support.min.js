/*! Plugins Corner - 2023-02-27
* http://www.PluginsCorner.com/
* Copyright (c) 2023 PluginsCorner */
var PLCOUtils=PLCOUtils||{},PLCO_Support=((PLCO_Support=PLCO_Support||{}).models=PLCO_Support.models||{},PLCO_Support.collections=PLCO_Support.collections||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},PLCOUtils.models=PLCOUtils.models||{},PLCOUtils.collections=PLCOUtils.collections||{},jQuery,PLCO_Support.models.Topic=PLCOUtils.models.Base.extend({idAttribute:"id",defaults:{title:"",content:"",replies:[],product:"",user_id:"",status:1},initialize:function(){this.set("replies",new PLCO_Support.collections.Replies(this.get("replies"))),this.set("user_id",PLCOUtils.globals.license.get("user_id"))},validate:function(e,t){var i=[];if(e.title||i.push(this.validation_error("title",PLCOUtils.t.NoSlug)),e.content||i.push(PLCOUtils.t.NoContent),e.product||i.push(PLCOUtils.t.NoProduct),i.length)return i},url:function(){var e=PLCOUtils.routes.topics;return!this.get("id")&&0!==this.get("id")||(e+="/"+this.get("id")),e}}),PLCO_Support.collections.Topics=PLCOUtils.collections.Base.extend({model:PLCO_Support.models.Topic,url:function(){return PLCOUtils.routes.topics+"/get_topics/"},comparator:function(e,t){return e.get("created_at")>t.get("created_at")?-1:t.get("created_at")>e.get("created_at")?1:0}}),PLCO_Support.models.Pagination=PLCOUtils.models.Base.extend({defaults:{current_page:1,items_per_page:10,total_items:0,state:"ACTIVE",extra:[{test:1}]}}),PLCO_Support.models.Reply=PLCOUtils.models.Base.extend({idAttribute:"ID",defaults:{topic_id:"",user_id:"",content:""},validate:function(e,t){var i=[];if(e.content||i.push(PLCOUtils.t.NoContent),i.length)return i},url:function(){var e=PLCOUtils.routes.replies;return!this.get("ID")&&0!==this.get("ID")||(e+="/"+this.get("ID")),e}}),PLCO_Support.collections.Replies=PLCOUtils.collections.Base.extend({model:PLCO_Support.models.Reply,comparator:function(e,t){return e.get("created_at")<t.get("created_at")?-1:t.get("created_at")<e.get("created_at")?1:0}}),PLCO_Support||{}),PLCOUtils=PLCOUtils||{},PLCO_Dashboard=PLCO_Dashboard||{},PLCO_Support=(PLCO_Dashboard.views=PLCO_Dashboard.views||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},jQuery(function(){PLCO_Support.views.Header=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("support_header"),render:function(){return this.$el.html(this.template({})),PLCOUtils.util.materialize(this.$el),this}}),PLCO_Support.views.Dashboard=PLCOUtils.views.Base.extend({className:"plco-container row",template:PLCOUtils.util.template("support_dashboard"),events:{"click .plco-open-topic":"openTopic"},initialize:function(){this.listenTo(this.collection,"add",this.render)},render:function(){return this.$el.html(this.template({})),this.renderHeader(),this.renderTopics(),this},renderHeader:function(){var e=new PLCO_Support.views.SupportHeader({});this.$(".plco-support-table").append(e.render().$el)},renderTopics:function(){this.$(".plco-support-table").append("<tbody>"),this.collection.each(this.renderTopic,this)},renderTopic:function(e){e=new PLCO_Support.views.SupportTopic({model:e});this.$(".plco-support-table tbody").append(e.render().$el)},openTopic:function(){PLCOUtils.globals.license.get("jwt_access")?this.modal(PLCO_Support.views.OpenTopic,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:new PLCO_Support.models.Topic,collection:PLCO_Support.globals.topics,products:PLCOUtils.globals.products}):PLCOUtils.toast_error("Your license has expired, please renew your license")}}),PLCO_Support.views.SupportHeader=PLCOUtils.views.Base.extend({tagName:"thead",className:"plco-table-header",template:PLCOUtils.util.template("table/header"),render:function(){return this.$el.html(this.template({})),this}}),PLCO_Support.views.SupportTopic=PLCOUtils.views.Base.extend({tagName:"tr",className:"plco-table-topic",template:PLCOUtils.util.template("table/topic"),events:{"click .plco-expand-topic":"toggleContent","click .plco-close-topic":"closeTopic","click .plco-reopen-topic":"reopenTopic","click .plco-edit-topic":"editTopic"},initialize:function(){var e=this;this.model.on("changed_status",function(){e.render(),e.toggleContent()})},render:function(){return this.$el.html(this.template({model:this.model})),this.renderContent(),PLCOUtils.util.materialize(this.$el),this},renderContent:function(){new PLCO_Support.views.SupportTopicContent({el:this.$(".plco-table-content"),model:this.model,collection:this.collection}).render()},toggleContent:function(){var e=this.$(".plco-expand-topic i");"expand_more"===e.text()?e.text("expand_less"):e.text("expand_more"),this.$(".plco-table-content").slideToggle()},editTopic:function(){this.modal(PLCO_Support.views.OpenTopic,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:this.model,collection:PLCO_Support.globals.topics,products:PLCOUtils.globals.products})},closeTopic:function(){PLCOUtils.globals.license.get("jwt_access")?this.modal(PLCO_Support.views.CloseTopic,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:this.model}):PLCOUtils.toast_error("Your license has expired, please renew your license")},reopenTopic:function(){PLCOUtils.globals.license.get("jwt_access")?this.modal(PLCO_Support.views.ReOpenTopic,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:this.model}):PLCOUtils.toast_error("Your license has expired, please renew your license")}}),PLCO_Support.views.SupportTopicContent=PLCOUtils.views.Base.extend({template:PLCOUtils.util.template("table/topic_content"),events:{"click .plco-add-reply":"addReply"},initialize:function(){this.listenTo(this.model.get("replies"),"add",this.render),this.listenTo(this.model.get("replies"),"remove",this.render)},render:function(){return this.$el.html(this.template({model:this.model})),this.renderReplies(),this},renderReplies:function(){0<this.model.get("replies").length?this.model.get("replies").each(function(e){e=new PLCO_Support.views.SupportTopicReply({model:e,topic:this.model,collection:this.model.get("replies")});this.$(".plco-table-replies").append(e.render().$el)},this):this.$(".plco-table-replies").html("<li>There are no replies yet</li>")},addReply:function(){var e;PLCOUtils.globals.license.get("jwt_access")?((e=new PLCO_Support.models.Reply).set({topic_id:this.model.get("ID"),user_id:PLCOUtils.globals.license.get("user_id")}),this.modal(PLCO_Support.views.AddReply,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:e,topic:this.model,collection:this.model.get("replies")})):PLCOUtils.toast_error("Your license has expired, please renew your license")}}),PLCO_Support.views.SupportTopicReply=PLCOUtils.views.Base.extend({tagName:"li",className:"plco-collection-item plco-table-reply plco-col plco-s12",template:PLCOUtils.util.template("table/topic_reply"),events:{"click .plco-edit-reply":"editReply","click .plco-delete-reply":"deleteReply"},initialize:function(e){this.topic=e.topic},render:function(){return this.$el.html(this.template({model:this.model})),this},editReply:function(){this.modal(PLCO_Support.views.AddReply,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:this.model,topic:this.topic,collection:this.topic.get("replies")})},deleteReply:function(){this.modal(PLCO_Support.views.DeleteReply,{"max-width":"60%",width:"1000px",in_duration:200,out_duration:0,model:this.model,topic:this.topic,collection:this.topic.get("replies")})}}),PLCO_Support.views.NoLicenseDashboard=PLCOUtils.views.Base.extend({className:"plco-container",template:PLCOUtils.util.template("no-license"),render:function(){return this.$el.html(this.template({})),this}})}),PLCO_Support||{}),PLCOUtils=PLCOUtils||{},PLCO_Support=(PLCO_Support.views=PLCO_Support.views||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},!function(l){l(function(){PLCO_Support.views.OpenTopic=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/open_topic"),events:function(){return _.extend({},PLCOUtils.util.ModalSteps.prototype.events,{"input .plco-input-change":"changeInput","change select":"changeSelect","click .plco-open-topic":"saveTopic"})},afterRender:function(){this.renderMCE()},renderMCE:function(){var e=this;setTimeout(function(){PLCOUtils.util.clearMCEEditor("plco-content"),e.editorInit("plco-content")},0)},editorInit:function(e){var i,t;"undefined"!=typeof tinymce&&tinymce&&(i=this,t=PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},e),tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,t.mce_init),tinyMCEPreInit.mceInit[e].setup=function(e){e.on("init",function(){e.setContent(i.model.get("content"))}),e.on("keyup",function(e){var t=tinymce.get("plco-content");i.model.set({content:t.getContent()})})},tinymce.init(tinyMCEPreInit.mceInit[e]))},changeInput:function(e){var t=e.target.value,e=l(e.target).attr("name");this.model.set(e,t)},changeSelect:function(e){var t=l(e.target).val(),e=l(e.target).attr("name");this.model.set(e,t)},saveTopic:function(){if(PLCOUtils.opened_modal_view.showLoader(),this.PLCO_clear_errors(),!this.model.isValid())return this.PLCO_display_errors(this.model);var e=this.model.save(),l=this;e&&(e.done(function(e,t,i){var o=l.collection.findWhere({title:l.model.get("title")});l.model.set(e),l.model.set("replies",new PLCO_Support.collections.Replies(l.model.get("replies"))),o?l.model.trigger("changed_status"):l.collection.add(l.model),l.close()}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}),e.complete(function(){PLCOUtils.opened_modal_view.hideLoader()}))}}),PLCO_Support.views.AddReply=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/add_reply"),events:{"click .plco-add-reply":"addReply"},afterInitialize:function(e){this.topic=e.topic},afterRender:function(){this.renderMCE()},renderMCE:function(){var e=this;setTimeout(function(){PLCOUtils.util.clearMCEEditor("plco-reply-content"),e.editorInit("plco-reply-content")},0)},editorInit:function(e){var i,t;"undefined"!=typeof tinymce&&tinymce&&(i=this,t=PLCOUtils.util.build_mce_init({mce:window.tinyMCEPreInit.mceInit["plco-dummy-editor"],qt:window.tinyMCEPreInit.qtInit["plco-dummy-editor"]},e),tinyMCEPreInit.mceInit=l.extend(tinyMCEPreInit.mceInit,t.mce_init),tinyMCEPreInit.mceInit[e].setup=function(e){e.on("init",function(){e.setContent(i.model.get("content"))}),e.on("keyup",function(e){var t=tinymce.get("plco-reply-content");i.model.set({content:t.getContent()})})},tinymce.init(tinyMCEPreInit.mceInit[e]))},addReply:function(){if(this.PLCO_clear_errors(),!this.model.isValid())return this.PLCO_display_errors(this.model);var o=this.model.get("id"),e=this.model.save(),l=this;e&&(e.done(function(e,t,i){l.model.set(e),o||l.collection.add(l.model),l.topic.set({status:1}),l.topic.trigger("changed_status"),l.close()}),e.error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}))}}),PLCO_Support.views.DeleteReply=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/delete_reply"),events:{"click .plco-yes":"deleteReply"},deleteReply:function(){var e=this.model.destroy(),o=this;e&&(e.done(function(e,t,i){PLCOUtils.toast_success("Successfully Deleted Reply"),o.close()}),e.error(function(e){e=e.responseText;PLCOUtils.toast_error(e.message)}))}}),PLCO_Support.views.CloseTopic=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/close_topic"),events:{"click .plco-yes":"closeTopic"},closeTopic:function(){PLCOUtils.opened_modal_view.showLoader();var o=this;l.ajax({headers:{"X-WP-Nonce":PLCOUtils.nonce},type:"POST",data:{ID:o.model.get("ID")},url:PLCOUtils.routes.topics+"/close_topic/"}).done(function(e,t,i){e&&(o.model.set({status:0}),o.model.trigger("changed_status"),o.close())}).error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}).complete(function(){PLCOUtils.opened_modal_view.hideLoader()})}}),PLCO_Support.views.ReOpenTopic=PLCOUtils.util.Modal.extend({template:PLCOUtils.util.template("modals/reopen_topic"),events:{"click .plco-yes":"reopenTopic"},reopenTopic:function(){PLCOUtils.opened_modal_view.showLoader();var o=this;l.ajax({headers:{"X-WP-Nonce":PLCOUtils.nonce},type:"POST",data:{ID:o.model.get("ID")},url:PLCOUtils.routes.topics+"/reopen_topic/"}).done(function(e,t,i){e&&(o.model.set({status:1}),o.model.trigger("changed_status"),o.close())}).error(function(e){e=JSON.parse(e.responseText);PLCOUtils.toast_error(e.message)}).complete(function(){PLCOUtils.opened_modal_view.hideLoader()})}})})}(jQuery),PLCO_Support||{}),PLCOUtils=PLCOUtils||{};(PLCO_Support=PLCO_Support||{}).globals=PLCO_Support.globals||{},PLCO_Support.views=PLCO_Support.views||{},PLCOUtils.util=PLCOUtils.util||{},PLCOUtils.globals=PLCOUtils.globals||{},PLCO_Support.globals=PLCO_Support.globals||{},PLCO_Support.views=PLCO_Support.views||{},function(e){let t=Backbone.Router.extend({$el:e("#plco-support-content"),routes:{support:"dashboard"},dash_view:null,dashboard:function(){var e=this;this.dash_view&&this.dash_view.remove(),PLCOUtils.globals.license.get("jwt_access")?PLCO_Support.globals.topics.fetch().success(function(){e.renderDashboard()}):this.renderNoLicenseDashboard()},renderNoLicenseDashboard:function(){this.dash_view=new PLCO_Support.views.NoLicenseDashboard({}),this.$el.html(this.dash_view.render().$el),window.scrollTo(0,0)},renderDashboard:function(){this.dash_view=new PLCO_Support.views.Dashboard({model:PLCOUtils.globals.license,collection:PLCO_Support.globals.topics}),this.$el.html(this.dash_view.render().$el),window.scrollTo(0,0)}});e(function(){PLCO_Support.globals.topics=new PLCO_Support.collections.Topics,PLCO_Support.globals.page_loader=new PLCOUtils.util.PageLoader,PLCO_Support.router=new t,Backbone.History.started||Backbone.history.start({hashchange:!0}),Backbone.history.getFragment()?(Backbone.history.fragment=null,Backbone.history.navigate(Backbone.history.getFragment(),{trigger:!0})):PLCO_Support.router.navigate("#support",{trigger:!0})})}(jQuery);